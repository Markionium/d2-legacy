"use strict";
/*
 * Copyright (c) 2004-2014, University of Oslo
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 * Neither the name of the HISP project nor the names of its contributors may
 * be used to endorse or promote products derived from this software without
 * specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
(function (angular, undefined) {
    var d2={scriptPath:function(){var a;return function(){var e,d,r;return a?a:(r=angular.element('<script src=""></script>'),e=document.getElementsByTagName("script"),angular.forEach(e,function(a){/d2(\.min)?\.js$/i.test(a.src)&&(r=a)}),d=r.src||"",a=d.substring(0,d.lastIndexOf("/")+1))}}()};angular.module("d2-config",[]),angular.module("d2-rest",["restangular"]),angular.module("d2-auth",["d2-rest"]),angular.module("d2-translate",["pascalprecht.translate","d2-config"]),angular.module("d2-contextmenu",[]),angular.module("d2-typeahead",[]),angular.module("d2-recordtable",["d2-filters","d2-typeahead","ui.bootstrap.tpls","ui.bootstrap.pagination"]),angular.module("d2-breadcrumbs",[]),angular.module("d2-filters",[]),angular.module("d2-detailsbox",[]),angular.module("d2-headerbar",[]),angular.module("d2-introlist",[]),angular.module("d2-period",["ui.select"]),angular.module("d2-ui-enhancements",[]),angular.module("d2-directives",["d2-breadcrumbs","d2-introlist","d2-headerbar","d2-recordtable","d2-detailsbox","d2-ui-enhancements","d2-contextmenu"]),angular.module("d2-services",["d2-auth"]),angular.module("d2",["d2-services","d2-directives","d2-filters"]);
function currentUser(n,r){function e(){function e(n){return u.then(function(e){return e.indexOf(n)>0?!0:r.reject("User does not have this permission")})}var u=n.currentUser.permissions.getList().then(function(n){return t=n.getDataOnly()});return u.hasPermission=e,u}var t,u;return u=n.currentUser.get(),u=angular.extend(u,{valueFor:function(n){return this[n]?this[n]:void 0},permissions:e()}),u.then(function(n){angular.extend(u,n.getDataOnly())}),u}currentUser.$inject=["d2Api","$q"],angular.module("d2-auth").factory("currentUser",currentUser);
function BreadCrumbsController(r,e){this.crumbClick=function(r){e.resetCrumbs(r.id),r.click&&r.click(angular.copy(r))},r.$watchCollection(function(){return e.getCrumbsList()},function(e){r.crumbsList=e})}BreadCrumbsController.$inject=["$scope","breadCrumbsService"],angular.module("d2-breadcrumbs").directive("breadCrumbs",function(){return{restrict:"E",replace:!0,scope:{homeCrumb:"="},templateUrl:d2.scriptPath()+"common/breadcrumbs/breadcrumbs.html",controllerAs:"breadCrumbs",controller:BreadCrumbsController}});
function breadCrumbsService(){var i=[];this.crumbsList=[],this.addCrumb=function(i,r){var s={};angular.isString(i)&&""!==i&&(s.name=i,s.id=this.crumbsList.length,r&&angular.isFunction(r)&&(s.click=function(){return r()}),this.crumbsList.push(s))},this.resetCrumbs=function(i){void 0===i&&(this.crumbsList=[]),this.crumbsList=_.filter(this.crumbsList,function(r){return r.id<=i})},this.getCrumbsList=function(){return i.concat(this.crumbsList)},this.addHomeCrumb=function(r,s){var t=this;return i=[],i.push({name:r,click:function(){t.crumbsList=[],angular.isFunction(s)&&s()}}),i[0]}}angular.module("d2-breadcrumbs").service("breadCrumbsService",breadCrumbsService);
function apiConfig(i){return{getUrl:function(n){if(!angular.isString(n))throw"Api Config Error: Resource URL should be a string";return"/"===n[0]&&(n=n.substr(1)),[i,n].join("/")}}}apiConfig.$inject=["API_ENDPOINT"],angular.module("d2-config").constant("API_ENDPOINT","/dhis/api"),angular.module("d2-config").factory("apiConfig",apiConfig);
function contextMenuController(n){this.contextMenuId=n.contextMenuId}function contextMenu(){return{restrict:"A",scope:{contextMenuId:"@contextMenu"},controller:contextMenuController,link:function(n,t){t.addClass("context-menu")}}}angular.module("d2-contextmenu").directive("contextMenu",contextMenu);
function detailsBox(){return{restrict:"EA",replace:!0,scope:{details:"=",headers:"="},templateUrl:d2.scriptPath()+"common/detailsbox/detailsbox.html",controller:function(e){var a=this;this.parseDetailsToArray=function(){var a=e.details;angular.isArray(e.headers)&&e.headers.length>0&&(a=_.pick(e.details,e.headers)),e.valueList=_.map(a,function(e,a){return{key:a,value:e}})},this.parseDetailsToArray(),e.$watch("details",function(e,t){e!==t&&a.parseDetailsToArray()})}}}angular.module("d2-detailsbox").directive("detailsBox",detailsBox);
function capitalize(){return function(i){return angular.isString(i)?i.charAt(0).toUpperCase()+i.slice(1):i}}angular.module("d2-filters").filter("capitalize",capitalize);
function translate(t){return function(a){return t(a)}}translate.$inject=["capitalizeFilter"],angular.module("d2-filters").filter("translate",translate);
function headerBar(){return{restrict:"E",replace:!0,transclude:!0,scope:{title:"@",link:"@",logo:"@",hasContent:"@"},templateUrl:d2.scriptPath()+"common/headerbar/headerbar.html",compile:function(e,t){t.title=t.title||"District Health Information Software 2",t.link=t.link||"../dhis-web-dashboard-integration/index.action",t.logo=t.logo||"../dhis-web-commons/css/light_blue/logo_banner.png"}}}angular.module("d2-headerbar").directive("headerBar",headerBar);
function introList(){return{restrict:"E",replace:!0,scope:{itemList:"=",itemClick:"&"},templateUrl:d2.scriptPath()+"common/introlist/introlist.html",link:function(t){t.clickFunction=function(i){var n={item:angular.copy(i)};t.itemClick(n)}}}}angular.module("d2-introlist").directive("introList",introList);
function periodService(e){var r,n,i,t,a=this,o="yyyy-mm-dd",d=["Daily","Weekly","Monthly","BiMonthly","Quarterly","SixMonthly","SixMonthlyApril","Yearly","FinancialApril","FinancialJuly","FinancialOct"],s=d,c=["coptic","ethiopian","islamic","julian","nepali","thai"];Object.defineProperties(this,{period:{get:function(){return n},set:function(e){n=e}},periodType:{get:function(){return r}}}),this.prepareCalendar=function(){var e=jQuery.calendars.instance(a.getCalendarType());dhis2.period.generator=new dhis2.period.PeriodGenerator(e,this.getDateFormat())},this.getDateFormat=function(){return o},this.getPeriodTypes=function(){return d},this.getCalendarTypes=function(){return c},this.getCalendarType=function(){return t},this.getPastPeriodsRecentFirst=function(){return i},this.setPeriodType=function(e){var n;_(d).contains(e)&&(r=e,n=dhis2.period.generator.generateReversedPeriods(r,0),i=dhis2.period.generator.filterFuturePeriodsExceptCurrent(n))},this.loadCalendarScript=function(e){jQuery.getScript("../dhis-web-commons/javascripts/jQuery/calendars/jquery.calendars."+e+".min.js",function(){a.prepareCalendar()}).error(function(){throw new Error("Unable to load "+e+" calendar")})},this.filterPeriodTypes=function(e){var r=_(s).findLastIndex(function(r){return _(e).contains(r)});return d=_.rest(s,r)},e.addEndPoint("system/info",!0),e.getEndPoint("system/info").get().then(function(e){o=e.dateFormat,"iso8601"===e.calendar?(t="gregorian",a.prepareCalendar()):(t=e.calendar,_(c).contains(t)&&a.loadCalendarScript(t))})}periodService.$inject=["d2Api"],angular.module("d2-period").service("periodService",periodService);
function periodSelectorDirective(e){return{restrict:"E",replace:!0,scope:!0,templateUrl:d2.scriptPath()+"common/period/periodselector.html",link:function(i){i.period={selectedPeriodType:void 0,selectedPeriod:void 0,periodTypes:e.getPeriodTypes(),periodsRecentFirst:e.getPastPeriodsRecentFirst()},i.$watch(function(){return e.getPeriodTypes()},function(r,o){r!==o&&(i.period.periodTypes=e.getPeriodTypes())}),i.changedPeriodType=function(r){e.setPeriodType(r),i.period.periodsRecentFirst=e.getPastPeriodsRecentFirst(),i.period.selectedPeriod=i.period.periodsRecentFirst[0],i.changePeriod(i.period.selectedPeriod)},i.changePeriod=function(i){void 0!==i&&(e.period=i)}}}}periodSelectorDirective.$inject=["periodService"],angular.module("d2-period").directive("periodSelector",periodSelectorDirective);
function recordTableBodyDirective(e){function a(a,t,r,n){var l=[];return angular.isArray(a)&&angular.isArray(t)?(angular.forEach(t,function(t,r){var c=angular.element('<tr ng-click="recordTable.rowClick(tableData.items['+r+'])"></tr>');angular.forEach(a,function(e){c.append(e.checkbox&&n.tableConfig.select?angular.element('<td><input type="checkbox" ng-model="tableData.items['+r+'].selected" ng-change="recordTable.checkAllSelected()" /></td>'):angular.element("<td>"+(t[e.name]||"")+"</td>"))}),l.push(e(c)(n))}),r.children().remove(),void r.append(l)):!0}return{restrict:"A",require:"^recordTable",link:function(e,t){a(e.tableConfig.columns,e.items,t),e.$watch("tableData.items",function(r,n){r!==n&&angular.isArray(e.tableConfig.columns)&&a(e.tableConfig.columns,e.tableData.items,t,e)}),e.$watch("tableConfig.columns",function(r,n){r!==n&&angular.isArray(e.tableData.items)&&a(e.tableConfig.columns,e.tableData.items,t,e)})}}}recordTableBodyDirective.$inject=["$compile"],angular.module("d2-recordtable").directive("recordTableBody",recordTableBodyDirective);
function RecordTableController(t,e,a,i,n){var r=this,l=!1;this.localData=!0,this.origData=[],this.typeAheadCache=n,this.pager={},this.contextMenu=t.contextMenu,this.allSelected=!1,t.tableData=t.tableData||{},t.tableData.items=[],t.tableConfig=t.tableConfig||{},this.getHeadersFromData=function(){var e=[];return _.map(t.tableData.items,function(t){var a=t.getDataOnly?t.getDataOnly():t;return _.map(a,function(t,a){e.push({name:a})}),e}),e=_.uniq(e,function(t){return t.name}),t.tableConfig.columns=e,t.tableConfig.columns},this.parseTableConfig=function(){var e=t.tableConfig||{};return t.pageItems=e.pageItems,t.tableConfig.columns=e.columns||void 0,this.rowClick=e.rowClick,this},this.parseTableData=function(){var a;return angular.isArray(t.tableDataSource)&&void 0!==t.tableDataSource.getList?(this.localData=!1,t.d2Service=t.tableDataSource,a=t.d2Service.getList(this.getRemoteParams())):a=t.tableDataSource,e.when(a).then(this.processData.bind(this)),this},this.processData=function(e){return t.tableData.items=this.origData=e,t.tableConfig=t.tableConfig||{},t.tableConfig.columns=t.tableConfig.columns||this.getHeadersFromData(),this.isSelectable()&&this.addSelectable(),t.pageItems&&(t.tableData.items=t.tableData.items.slice(0,t.pageItems)),e&&e.meta&&(t.meta=e.meta,this.processMetaData()),angular.forEach(t.tableConfig.columns,function(t){r.typeAheadCache.add(t.name,r.getValuesForColumn(t))}),e&&this.localData&&(this.pager={currentPage:1,resultTotal:e.length,itemsPerPage:t.pageItems}),this},this.isSelectable=function(){return angular.isDefined(t.tableConfig)&&t.tableConfig.select===!0?!0:!1},this.addSelectable=function(){var e={name:"",checkbox:!0};t.tableConfig.columns[0].checkbox!==!0&&(t.tableConfig.columns=[e].concat(t.tableConfig.columns),_.each(t.tableData.items,function(t){t.selected=!1}))},this.isAllSelected=function(){return _.filter(t.tableData.items,"selected").length===t.tableData.items.length?!0:!1},this.checkAllSelected=function(){this.isAllSelected()?this.allSelected!==!0&&(this.allSelected=!0):this.allSelected===!0&&(this.allSelected=!1),t.$emit("RECORDTABLE.selection.changed",this.getSelectedItems())},this.selectAll=function(){this.allSelected=this.isAllSelected()?!1:!0,angular.forEach(t.tableData.items,function(t){t.selected=this.allSelected},this),t.$emit("RECORDTABLE.selection.changed",this.getSelectedItems())},this.getRowDataColumns=function(){return _.filter(t.tableConfig.columns,function(t){return!t.checkbox})},this.getItems=function(){return t.tableData.items},this.getSelectedItems=function(){return _.filter(this.getItems(),"selected")},this.processMetaData=function(){this.setUpPager()},this.setUpPager=function(){this.pager.itemsPerPage||(this.pager.itemsPerPage=t.tableData.items.length),this.pager.pageCount=t.meta.pager.pageCount,this.pager.resultTotal=t.meta.pager.total,this.pager.currentPage=t.meta.pager.page},this.getCurrentPageParams=function(){return this.pager.currentPage>1?this.pager.currentPage:void 0},this.switchPage=function(){if(this.localData===!0){if(!angular.isNumber(t.pageItems)||!angular.isNumber(this.pager.currentPage))return;t.tableData.items=this.origData.slice(t.pageItems*(this.pager.currentPage-1),t.pageItems*this.pager.currentPage)}else this.requestNewDataFromService()},this.setSortOrder=function(e){var a=angular.copy(t.tableConfig.columns);angular.forEach(a,function(t){t.sort=t.name===e.name?"asc"===e.sort?"desc":"asc":void 0}),t.tableConfig.columns=a},this.getColumnsWithFilters=function(){return _.filter(t.tableConfig.columns||[],"searchable")},this.getFilterObject=function(){var t=this.getColumnsWithFilters(),e={};return 0===t.length?!1:(angular.forEach(t,function(t){e[t.name]=t.filter}),e)},this.getRemoteFilters=function(){var t=[];if(this.getFilterObject())return angular.forEach(this.getFilterObject(),function(e,a){e&&t.push(a+":like:"+e)}),t.length>0?t:void 0},this.getRemoteParams=function(){var t={},e=this.getRemoteFilters(),a=this.getCurrentPageParams();return e&&(t.filter=e),a&&(t.page=a),t},this.requestNewDataFromService=function(){var a=this.getRemoteParams();e.when(t.d2Service.getList(a)).then(this.processData.bind(this))},this.doLocalFiltering=function(){this.getFilterObject()&&(t.tableData.items=a("filter")(this.origData,this.getFilterObject()))},this.doLocalSorting=function(){var e,a=_.filter(t.tableConfig.columns,"sort"),i=_.pluck(a,"name");0!==a.length&&(e=_.sortBy(t.tableData.items,i),a[0]&&"desc"===a[0].sort&&(e=e.reverse()),t.tableData.items=e)},this.serviceSorting=function(){var e=_.filter(t.tableConfig.columns,"sort");0!==e.length&&window.alert("API Sorting not yet implemented")},this.getValuesForColumn=function(e){return e&&e.name&&angular.isString(e.name)?_.map(t.tableData.items,function(t){return t[e.name]}):[]},t.$watch("tableConfig.columns",function(e,a){a!==e&&(r.localData&&(r.doLocalFiltering(),r.doLocalSorting()),t.d2Service&&(l||(i(function(){r.requestNewDataFromService(),l=!1},300),l=!0)))},!0),t.$watch(function(){return r.pager.currentPage||void 0},function(t,e){e&&t!==e&&r.switchPage()}),t.$watch("tableDataSource",function(t,e){t!==e&&r.parseTableData()})}RecordTableController.$inject=["$scope","$q","$filter","$timeout","typeAheadService"],angular.module("d2-recordtable").controller("RecordTableController",RecordTableController);
function recordTable(){return{restrict:"E",replace:!0,scope:{tableConfig:"=",tableDataSource:"=tableDataSource",contextMenu:"=tableContextMenu"},templateUrl:d2.scriptPath()+"common/recordtable/recordtable.html",controllerAs:"recordTable",controller:"RecordTableController",link:function(e,r,t,a){a.parseTableConfig(),a.parseTableData()}}}angular.module("d2-recordtable").directive("recordTable",recordTable);
function recordTableHeader(e,n){function a(n,a){var l=['<th class="table-header">','<a ng-show="tableConfig.columns['+n+"].sortable && !tableConfig.columns["+n+'].checkbox" href="#" ng-class="\'sorting-\' + tableConfig.columns['+n+'].sort" ','translate ng-bind="tableConfig.columns['+n+'].name"></a>','<span ng-show="!tableConfig.columns['+n+"].sortable && !tableConfig.columns["+n+'].checkbox" ng-bind="tableConfig.columns['+n+'].name"></span>','<input ng-show="tableConfig.columns['+n+"].searchable && !tableConfig.columns["+n+'].checkbox" ng-model="tableConfig.columns['+n+'].filter" type="text" ','ng-class="tableConfig.headerInputClass"',' typeahead="name for name in getTypeAheadFor(tableConfig.columns['+n+']) | filter:$viewValue | limitTo:8"  placeholder="Search in {{tableConfig.columns['+n+'].name}}">','<input type="checkbox" ng-show="tableConfig.select && tableConfig.columns['+n+'].checkbox" ng-model="recordTable.allSelected" ng-change="recordTable.selectAll()" />',"</th>"].join(""),t=angular.element(l);return e(t)(a)}function l(e,l,t){if(angular.isArray(e.tableConfig.columns)){var o=angular.element("<tr></tr>");angular.forEach(e.tableConfig.columns,function(n,l){o.append(a(l,e))}),l.children().length>0?l.children().replaceWith(o):l.append(o),l.find("a").bind("click",function(a){var l="".replace.apply(angular.element(a.target).attr("ng-bind"),[".name",""]);angular.isString(l)&&e.$apply(function(){t.setSortOrder(n(l)(e))})})}}return{restrict:"A",require:"^recordTable",link:{pre:function(e,n,a,t){l(e,n,t),e.$watch("tableConfig.columns.length",function(){l(e,n,t)},!0),e.getTypeAheadFor=function(e){return t.typeAheadCache[e.name]}}}}}recordTableHeader.$inject=["$compile","$parse"],angular.module("d2-recordtable").directive("recordTableHeader",recordTableHeader);
function recordTableSelectable(e){function c(e){return function(){e.selected=!0}}return{restrict:"E",replace:!0,require:"^recordTable",scope:!1,template:'<input type="checkbox" ng-checked="item.selected" />',link:function(t,l,r,i){t.item=e(r.item)(t),t.item?i.rowClick=c(t.item):l.click(function(){t.$apply(i.selectAll())})}}}recordTableSelectable.$inject=["$parse"],angular.module("d2-recordtable").directive("recordTableSelectable",recordTableSelectable);
function d2Api(t){var n=function(){this.indicators=this.all("indicators"),this.currentUser=this.one("me"),this.currentUser.permissions=this.one("me").all("authorization"),this.schemas=this.all("schemas"),this.addEndPoint=function(t,n){if(t.match(/^\//))throw"D2Api Error: EndPoint should not have a leading slash";if(this[t])throw'D2Api Error: EndPoint "'+t+'" already exists';return this[t]=n?this.one(t):this.all(t),this[t]},this.getEndPoint=function(t){if(void 0===this[t])throw"D2Api Error: Endpoint does not exist";return this[t]},this.hasEndPoint=function(t){return this[t]?!0:!1}};this.setBaseUrl=function(t){this.config.setBaseUrl(t)},this.$get=function(t){var e;return e=n,e.prototype=t,new n},this.config=t,this.config.addResponseInterceptor(function(t,n,e){if("getList"===n&&t&&t[e]){var r=t[e],i=angular.copy(t);return delete i[e],r.meta=i,r}return t}),this.config.setResponseExtractor(function(t){var n=t,e=angular.copy(t);return n.getDataOnly=function(){return e},n}),this.config.setOnElemRestangularized(function(t,n,e,r){return n||t.getDataOnly?t:angular.isString(t)?t:(t.getDataOnly=function(){var n=angular.copy(t);return n=r.stripRestangular(n),delete n.getDataOnly,n},t)})}function userIsLoggedOutInterceptor(t){return{response:function(n){return n&&"string"==typeof n.data&&n.data.indexOf('<body class="loginPage">')>=0&&t.location.reload(),n}}}function restConfig(t,n){t.interceptors.push("userIsLoggedOutInterceptor"),n.setBaseUrl("/dhis/api")}d2Api.$inject=["RestangularProvider"],userIsLoggedOutInterceptor.$inject=["$window"],restConfig.$inject=["$httpProvider","d2ApiProvider"],angular.module("d2-rest").provider("d2Api",d2Api),angular.module("d2-rest").factory("userIsLoggedOutInterceptor",userIsLoggedOutInterceptor),angular.module("d2-rest").config(restConfig);
function schemaProcessor(){return function(s){var r,t=function(){this.schemas=[],this.schemaGroups={},this.getKlassGroupName=function(s){var r=s.split(".");return r[r.length-2]},this.addSchemasToGroups=function(s){var r=this,t={};return angular.forEach(s,function(s){var i=r.getKlassGroupName(s.klass);void 0===t[i]&&(t[i]=[]),t[i].push(s)}),this.schemaGroups=t,t},this.filterSchemasByPermissions=function(s){var r=[];return angular.forEach(this.schemas,function(t){t.isAuthorizedBy(s)&&r.push(t)}),r},this.process=function(s){this.schemas=s,angular.forEach(this.schemas,function(s){s.getPermissions=function(){var s={all:[]};return angular.forEach(this.authorities,function(r){"DELETE"===r.type?s.remove=r.authorities:s[r.type.toLowerCase()]=r.authorities,s.all=s.all.concat(r.authorities)}),s},s.isAuthorizedBy=function(r){var t=!1,i=s.getPermissions();return angular.forEach(i.all,function(a){r.indexOf(a)>=0&&(s.permissions=i,t=!0)}),t}})},this.getSchemaGroupsForPermissions=function(s){var r=this.filterSchemasByPermissions(s),t=this.addSchemasToGroups(r);return t},this.filterByGroupNames=function(s){var r=this.addSchemasToGroups(this.schemas),t={};return angular.forEach(s,function(s){r[s]&&(t[s]=r[s])}),t}};return r=new t,r.process(s||[]),r}}angular.module("d2-services").factory("schemaProcessor",schemaProcessor);
function systemSettingsService(t){var e={};this.getAll=function(){return e},this.get=function(t){return e[t]},t.addEndPoint("systemSettings",!0),t.systemSettings.get().then(function(t){angular.extend(e,t.getDataOnly())})}systemSettingsService.$inject=["d2Api"],angular.module("d2-settings",["d2-rest"]).service("systemSettingsService",systemSettingsService);
function d2LanguageLoader(n,a,e){var r={};return function(t){var i=n.defer();return r[t.key]?(r[t.key]=angular.extend(e.apiTranslations,r[t.key]),i.resolve(angular.extend(e.apiTranslations,r[t.key]))):a.get("common/i18n/"+t.key+".json").success(function(n){r[t.key]=angular.extend(e.apiTranslations,n),i.resolve(r[t.key])}).error(function(){i.reject(t.key)}),i.promise}}function d2MissingTranslationHandler(n){return function(a,e){n.add(a),n.translateThroughApi(e)}}function translateApiService(n,a,e,r,t){var i=this,s=!1,o=[];this.apiTranslations={},this.add=function(n){angular.isString(n)&&""!==n.trim()&&(o.push(n.trim()),o=_.uniq(o))},this.getTranslationKeys=function(){var n=o;return o=[],n},this.getTranslationsFromApi=function(o){var l=n.defer();return s&&l.reject("waiting"),s=!0,r(function(){var n=i.getTranslationKeys();t.post(e.getUrl("i18n"),n).success(function(n){l.resolve(n)}).error(function(n){l.reject(n)}),a.refresh(o),s=!1},100,!1),l.promise},this.translateThroughApi=function(n){s===!1&&this.getTranslationsFromApi(n).then(function(n){i.apiTranslations=n,a.refresh()})}}function translateConfig(n){n.useLoader("d2LanguageLoader"),n.preferredLanguage("en"),n.useMissingTranslationHandler("d2MissingTranslationHandler")}d2LanguageLoader.$inject=["$q","$http","translateApiService"],d2MissingTranslationHandler.$inject=["translateApiService"],translateApiService.$inject=["$q","$translate","apiConfig","$timeout","$http"],translateConfig.$inject=["$translateProvider"],angular.module("d2-translate").factory("d2MissingTranslationHandler",d2MissingTranslationHandler),angular.module("d2-translate").service("translateApiService",translateApiService),angular.module("d2-translate").factory("d2LanguageLoader",d2LanguageLoader),angular.module("d2-translate").config(translateConfig);
function typeAheadService(){this.add=function(e,i){if(!angular.isString(e))throw"Only string identifiers are allowed";if("get"===e||"add"===e)throw"Cannot override add or get methods";if(void 0!==i&&!angular.isArray(i))throw"Values should be an array";this[e]=_.uniq((this[e]||[]).concat(i))},this.get=function(e){return this[e]||[]}}angular.module("d2-typeahead").service("typeAheadService",typeAheadService);
function closableController(l){this.close=function(){l.toggleValue=!l.toggleValue}}function closable(){return{restrict:"A",controller:closableController,controllerAs:"closable",scope:{toggleValue:"=closable"},link:function(l,e,o,n){var c=angular.element('<span class="closable-button fa fa-times-circle-o"></span>');c.on("click",function(){l.$apply(function(){n.close()})}),e.append(c),e.addClass("closable")}}}angular.module("d2-ui-enhancements").directive("closable",closable);
})(angular);
